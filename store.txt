document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('scanButton').addEventListener('click', () => {
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
      const currentUrl = tabs[0].url;
      chrome.runtime.sendMessage({
        action: 'scanUrl',
        url: currentUrl
      }, (response) => {
        document.getElementById('result').innerText = JSON.stringify(response, null, 2);
      });
    });
  });
});

const options = {
  method: 'GET',
  headers: {
    accept: 'application/json',
    'x-apikey': ''
  }
};

fetch(`https://www.virustotal.com/api/v3/urls/${encodedUrl}`, options)
  .then(res => res.json())
  .then(res => console.log(res))
  .catch(err => console.error(err));

    chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
    if (request.action === "scanUrl") {
      const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          'x-apikey': ''
        }
      };
      const encodedPaddedUrl = btoa(request.url);
      const encodedUrl = encodedPaddedUrl.replace(/=*$/, '')
      fetch(`https://www.virustotal.com/api/v3/urls/${encodedUrl}`, options)
      .then(response => {
        if (!response.ok) {
          throw new Error('Resource not found');
        }
        return response.json();
      })
      .then(data => sendResponse(data))
      .catch(error => {
        console.error('Error:', error);
        sendResponse({ error: error.message });
      });
      return true;
    }
});










document.addEventListener('DOMContentLoaded', function () {
  document.getElementById('scanButton').addEventListener('click', () => {
    chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
      const currentUrl = tabs[0].url;
      chrome.runtime.sendMessage(
        {
          action: 'scanUrl',
          url: currentUrl
        },
        (response) => {
          document.getElementById('result').innerText = JSON.stringify(response, null, 2);
        }
      );
    });
  });
});

chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "scanUrl") {
    const apiKey = "";
    const encodedPaddedUrl = btoa(request.url);
    const encodedUrl = encodedPaddedUrl.replace(/=*$/, '');
    console.log('encodedUrl:', encodedUrl);

    fetch(`https://www.virustotal.com/api/v3/urls/${encodedUrl}`, {
      method: 'GET',
      headers: {
        accept: 'application/json',
        'x-apikey': apiKey
      }
    })
      .then(response => {
        if (!response.ok) {
          throw new Error('Resource not found');
        }
        return response.json();
      })
      .then(data => sendResponse(data))
      .catch(error => {
        console.error('Error:', error);
        sendResponse({ error: error.message });
      });

    return true;
  }
});
